# RevenueCat Implementation Examples

This document provides practical examples of how to use RevenueCat features throughout your CaloriTrack app.

## ðŸŽ¯ Quick Start Examples

### Check if User Has Premium

```typescript
import { useRevenueCat } from '@/context/revenuecat-context';

function MyComponent() {
  const { isPremium, isLoading } = useRevenueCat();

  if (isLoading) {
    return <ActivityIndicator />;
  }

  return (
    <View>
      <Text>Status: {isPremium ? 'Premium' : 'Free'}</Text>
    </View>
  );
}
```

### Gate Premium Features

```typescript
import { PremiumGate } from '@/components/premium';

function AdvancedAnalyticsScreen() {
  return (
    <PremiumGate
      featureName="Advanced Analytics"
      featureDescription="Get detailed insights into your nutrition and progress"
    >
      {/* Premium content here */}
      <DetailedAnalytics />
    </PremiumGate>
  );
}
```

### Show Premium Badge

```typescript
import { PremiumBadge } from '@/components/premium';

function FeatureList() {
  return (
    <View>
      <Text>
        AI Meal Planning <PremiumBadge size="small" />
      </Text>
    </View>
  );
}
```

### Present Paywall Manually

```typescript
import { useRouter } from 'expo-router';
import { usePremiumFeature } from '@/components/premium';

function RecipeDetailScreen() {
  const { isPremium } = usePremiumFeature();
  const router = useRouter();

  const handleSaveRecipe = () => {
    if (!isPremium) {
      // Show paywall
      router.push('/paywall');
      return;
    }

    // Save recipe (premium feature)
    saveRecipe();
  };

  return (
    <Button title="Save Recipe" onPress={handleSaveRecipe} />
  );
}
```

### Custom Premium Prompt

```typescript
import { PremiumGate } from '@/components/premium';

function ExportDataScreen() {
  return (
    <PremiumGate
      featureName="Export Your Data"
      featureDescription="Export your nutrition data to CSV or PDF format"
      fallback={
        <CustomUpgradePrompt 
          feature="Data Export" 
          benefits={[
            'Export to CSV format',
            'Generate PDF reports',
            'Email reports to yourself'
          ]}
        />
      }
    >
      <DataExportTools />
    </PremiumGate>
  );
}
```

## ðŸŽ¨ UI Examples

### Premium Feature Card

```typescript
import { PremiumFeatureCard } from '@/components/premium';

function SettingsScreen() {
  return (
    <ScrollView>
      <Text style={styles.sectionTitle}>Premium Features</Text>
      
      <PremiumFeatureCard
        icon="ðŸ¤–"
        title="AI Meal Planning"
        description="Get personalized meal plans generated by AI"
      />
      
      <PremiumFeatureCard
        icon="ðŸ“Š"
        title="Advanced Analytics"
        description="Detailed insights and progress tracking"
      />
      
      <PremiumFeatureCard
        icon="ðŸ“±"
        title="Multi-Device Sync"
        description="Access your data across all devices"
      />
    </ScrollView>
  );
}
```

### Conditional Rendering

```typescript
import { useRevenueCat } from '@/context/revenuecat-context';

function DashboardScreen() {
  const { isPremium } = useRevenueCat();

  return (
    <View>
      <BasicDashboard />
      
      {isPremium ? (
        <PremiumDashboardWidgets />
      ) : (
        <UpgradeCard />
      )}
    </View>
  );
}
```

### Limited Feature Access

```typescript
import { useRevenueCat } from '@/context/revenuecat-context';

function RecipeScreen() {
  const { isPremium } = useRevenueCat();
  const [recipes, setRecipes] = useState([]);

  // Show limited recipes for free users
  const displayedRecipes = isPremium 
    ? recipes 
    : recipes.slice(0, 3); // Only show 3 recipes for free users

  return (
    <ScrollView>
      {displayedRecipes.map(recipe => (
        <RecipeCard key={recipe.id} recipe={recipe} />
      ))}
      
      {!isPremium && recipes.length > 3 && (
        <View style={styles.upgradePrompt}>
          <Text>Unlock {recipes.length - 3} more recipes with Premium</Text>
          <Button 
            title="Upgrade Now" 
            onPress={() => router.push('/paywall')} 
          />
        </View>
      )}
    </ScrollView>
  );
}
```

## ðŸ” Advanced Examples

### Check Subscription Status on Action

```typescript
import { useRevenueCat } from '@/context/revenuecat-context';
import { Alert } from 'react-native';

function CameraScreen() {
  const { isPremium, checkSubscriptionStatus } = useRevenueCat();
  const router = useRouter();

  const handlePhotoAnalysis = async () => {
    // Refresh subscription status
    const hasAccess = await checkSubscriptionStatus();

    if (!hasAccess) {
      Alert.alert(
        'Premium Feature',
        'Upgrade to Premium for unlimited photo analysis',
        [
          { text: 'Maybe Later', style: 'cancel' },
          { text: 'Upgrade', onPress: () => router.push('/paywall') }
        ]
      );
      return;
    }

    // Proceed with analysis
    analyzePhoto();
  };

  return (
    <Button title="Analyze Photo" onPress={handlePhotoAnalysis} />
  );
}
```

### Restore Purchases

```typescript
import { useRevenueCat } from '@/context/revenuecat-context';
import { Alert } from 'react-native';

function SettingsScreen() {
  const { restorePurchases } = useRevenueCat();
  const [isRestoring, setIsRestoring] = useState(false);

  const handleRestore = async () => {
    setIsRestoring(true);
    try {
      const hasAccess = await restorePurchases();
      
      if (hasAccess) {
        Alert.alert('Success', 'Your purchases have been restored!');
      } else {
        Alert.alert('No Purchases', 'No previous purchases found.');
      }
    } catch (error) {
      Alert.alert('Error', 'Failed to restore purchases.');
    } finally {
      setIsRestoring(false);
    }
  };

  return (
    <Button 
      title={isRestoring ? 'Restoring...' : 'Restore Purchases'} 
      onPress={handleRestore}
      disabled={isRestoring}
    />
  );
}
```

### Access Customer Info

```typescript
import { useRevenueCat } from '@/context/revenuecat-context';

function SubscriptionInfoScreen() {
  const { customerInfo, isPremium } = useRevenueCat();

  if (!isPremium || !customerInfo) {
    return <Text>No active subscription</Text>;
  }

  const premiumEntitlement = customerInfo.entitlements.active['premium'];
  const expirationDate = premiumEntitlement?.expirationDate;

  return (
    <View>
      <Text>Subscription Status: Active âœ…</Text>
      {expirationDate && (
        <Text>Renews: {new Date(expirationDate).toLocaleDateString()}</Text>
      )}
    </View>
  );
}
```

### Feature Limits

```typescript
import { useRevenueCat } from '@/context/revenuecat-context';

const FREE_SCAN_LIMIT = 3;

function useFoodScans() {
  const { isPremium } = useRevenueCat();
  const [scanCount, setScanCount] = useState(0);

  const canScan = isPremium || scanCount < FREE_SCAN_LIMIT;
  const scansRemaining = isPremium 
    ? 'Unlimited' 
    : Math.max(0, FREE_SCAN_LIMIT - scanCount);

  const incrementScanCount = () => {
    if (!isPremium) {
      setScanCount(prev => prev + 1);
    }
  };

  return { canScan, scansRemaining, incrementScanCount };
}

function ScanScreen() {
  const { canScan, scansRemaining, incrementScanCount } = useFoodScans();
  const router = useRouter();

  const handleScan = () => {
    if (!canScan) {
      Alert.alert(
        'Scan Limit Reached',
        'Upgrade to Premium for unlimited scans!',
        [
          { text: 'Cancel', style: 'cancel' },
          { text: 'Upgrade', onPress: () => router.push('/paywall') }
        ]
      );
      return;
    }

    incrementScanCount();
    performScan();
  };

  return (
    <View>
      <Text>Scans remaining today: {scansRemaining}</Text>
      <Button title="Scan Food" onPress={handleScan} />
    </View>
  );
}
```

## ðŸ“Š Analytics Integration

### Track Feature Usage

```typescript
import { useRevenueCat } from '@/context/revenuecat-context';

function useFeatureTracking() {
  const { isPremium } = useRevenueCat();

  const trackFeatureAccess = (featureName: string) => {
    // Log to your analytics service
    console.log('Feature Access:', {
      feature: featureName,
      isPremium,
      timestamp: new Date().toISOString(),
    });
    
    // If using Firebase Analytics:
    // analytics().logEvent('feature_access', {
    //   feature_name: featureName,
    //   subscription_status: isPremium ? 'premium' : 'free',
    // });
  };

  return { trackFeatureAccess };
}
```

## ðŸŽ Promotional Features

### Time-Limited Trial

```typescript
import { useRevenueCat } from '@/context/revenuecat-context';

function TrialPrompt() {
  const { customerInfo } = useRevenueCat();
  const router = useRouter();

  // Check if user has ever been premium
  const hasHadTrial = customerInfo?.allPurchasedProductIdentifiers.length > 0;

  if (hasHadTrial) {
    return null; // Don't show trial prompt to returning customers
  }

  return (
    <View style={styles.trialBanner}>
      <Text style={styles.trialText}>
        ðŸŽ‰ Try Premium FREE for 7 days!
      </Text>
      <Button 
        title="Start Trial" 
        onPress={() => router.push('/paywall')} 
      />
    </View>
  );
}
```

## ðŸ› ï¸ Utility Functions

### Premium Feature Wrapper Hook

```typescript
import { useRevenueCat } from '@/context/revenuecat-context';
import { useRouter } from 'expo-router';
import { Alert } from 'react-native';

export function usePremiumAction() {
  const { isPremium } = useRevenueCat();
  const router = useRouter();

  const withPremiumCheck = (
    action: () => void,
    featureName: string = 'Premium Feature'
  ) => {
    return () => {
      if (!isPremium) {
        Alert.alert(
          featureName,
          'This is a premium feature. Upgrade to access it.',
          [
            { text: 'Cancel', style: 'cancel' },
            { text: 'Upgrade', onPress: () => router.push('/paywall') }
          ]
        );
        return;
      }
      action();
    };
  };

  return { withPremiumCheck, isPremium };
}

// Usage:
function RecipeScreen() {
  const { withPremiumCheck } = usePremiumAction();

  const handleExport = withPremiumCheck(
    () => exportRecipe(),
    'Recipe Export'
  );

  return <Button title="Export" onPress={handleExport} />;
}
```

## ðŸ’¡ Best Practices

1. **Always check `isLoading`** before checking `isPremium`
2. **Provide clear value proposition** when showing upgrade prompts
3. **Make restore purchases easily accessible** in settings
4. **Test both free and premium flows** thoroughly
5. **Handle errors gracefully** with user-friendly messages
6. **Refresh subscription status** after significant time gaps
7. **Use descriptive feature names** in alerts and prompts
8. **Consider offering trials** to increase conversion

## ðŸŽ¨ UI/UX Tips

- **Visual indicators**: Use badges, icons, or colors to mark premium features
- **Soft gates**: Show previews of premium features before locking them
- **Progressive disclosure**: Introduce premium features gradually
- **Clear benefits**: Explain what users get with premium
- **Easy upgrade path**: Make it simple to upgrade from any screen
- **Restore option**: Always provide a way to restore purchases

---

**Need Help?** Check the [REVENUECAT_SETUP.md](./REVENUECAT_SETUP.md) for configuration details.


